/*! DexterJS - v0.5.4 -  * https://github.com/leobalter/DexterJS
 * Copyright (c) 2014 Leonardo Balter; Licensed MIT, GPL */

!function(){function setDexterObjs(a,b,c){a._oldCall=b[c],a._seenObj=b,a._seenMethod=c}function DexterObj(a,b,c,d){var e=this;if(this.called=0,this.isActive=!0,"string"!=typeof c)throw"Dexter should receive method name as a String";if(!b||"function"!=typeof b[c])throw'Dexter should receive a valid object and method combination in arguments. Ex.: window & "alert".';"function"==typeof d&&(this.callback=d),setDexterObjs(this,b,c),b[c]=function(){var b=[].slice.apply(arguments);return e.called=e.called+1,actions[a].call(this,e,b)}}function createDexterObj(a){return function(b,c,d){var e=new DexterObj(a,b,c,d);return Dexter.stored.push(e),e}}function restoreAll(){for(;Dexter.stored.length;)Dexter.stored.pop().restore();return 0===Dexter.stored.length}function Timer(){return this instanceof Timer?(setTimeout=fakeSetTimeout,setInterval=fakeSetInterval,clearTimeout=fakeClearTimer,clearInterval=fakeClearTimer,void 0):new Timer}function fakeSetTimeout(a,b){return timerArray.push({cb:a,time:b,type:"timeout"}),timerArray.length}function fakeSetInterval(a,b){return timerArray.push({cb:a,time:b,type:"interval",originalTime:b}),timerArray.length}function fakeClearTimer(a){timerArray.splice(a-1,1)}var Dexter={stored:[]},timerArray=[],restore,actions,originalTimeout=setTimeout,originalInterval=setInterval,originalClearTimeout=clearTimeout,originalClearInterval=clearInterval;restore=function(){this._seenObj[this._seenMethod]=this._oldCall,this.isActive=!1},actions={spy:function(a,b){var c=a._oldCall.apply(this,b);return"function"==typeof a.callback&&a.callback.apply(this,b),c},fake:function(a,b){return"function"==typeof a.callback?a.callback.apply(this,b):void 0}},DexterObj.prototype={restore:restore},Timer.prototype={tick:function(a){for(var b,c=0;c<timerArray.length;c++)b=timerArray[c],timerArray[c].time=b.time-a,"timeout"===b.type&&Timer.prototype.tickTimeout(c),"interval"===b.type&&Timer.prototype.tickInterval(a,c)},tickTimeout:function(a){var b=timerArray[a];b.time<=0&&(Timer.prototype.executeCallback(a),timerArray.splice(a-1,1))},tickInterval:function(a,b){var c=timerArray[b],d=Math.floor(a/c.originalTime)/1;for(c.time<=0&&(timerArray[b].time=c.originalTime-c.time);d;)Timer.prototype.executeCallback(b),d--},executeCallback:function(index){var thisTimer=timerArray[index];"string"==typeof thisTimer.cb?eval(thisTimer.cb):thisTimer.cb()},restore:function(){setTimeout=originalTimeout,setInterval=originalInterval,clearInterval=originalClearInterval,clearTimeout=originalClearTimeout,this.resetTimers()},resetTimers:function(){timerArray=[]}},Dexter.spy=createDexterObj("spy"),Dexter.fake=createDexterObj("fake"),Dexter.restore=restoreAll,Dexter.timer=Timer,"undefined"!=typeof module&&module.exports?module.exports=Dexter:"function"==typeof define&&define.amd?define("dexter",[],function(){return Dexter}):"undefined"!=typeof window&&(window.Dexter=Dexter)}(),function(a){function b(a,b){if(1!==a||b)throw new Error("INVALID_STATE_ERR")}function c(b){var c,d;return"undefined"!=typeof a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b)),c}var d,e,f,g,h,i={};return i.xhr=function(){var a;try{return a=new XMLHttpRequest,XMLHttpRequest}catch(b){return!1}}(),"undefined"!=typeof module&&module.exports?(module.exports=function(){return{}},!1):(i.xhr&&("function"==typeof define&&define.amd?define("fakeXHR",[],function(){return new h}):(d=window.Dexter,d.fakeXHR=function(){return new h})),e={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},f=["Accept-Charset","Accept-Encoding","Connection","Content-Length","Cookie","Cookie2","Content-Transfer-Encoding","Date","Expect","Host","Keep-Alive","Referer","TE","Trailer","Transfer-Encoding","Upgrade","User-Agent","Via"],g={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4,onabort:null,onerror:null,onload:null,onloadend:null,onloadstart:null,onprogress:null,onreadystatechange:null,ontimeout:null,readyState:0,response:"",responseText:"",responseType:"",responseXML:null,withCredentials:!1,status:0,statusText:"",timeout:0,abort:function(){this.aborted=!0,this.errorFlag=!0,this.method=null,this.url=null,this.async=void 0,this.username=null,this.password=null,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1,this.__DexterStateChange(this.readyState>this.UNSENT&&this.sendFlag?this.DONE:this.UNSENT)},getResponseHeader:function(a){var b,c=this.responseHeaders;if(this.readyState<this.HEADERS_RECEIVED)return null;if(/^Set-Cookie2?$/i.test(a))return null;a=a.toLowerCase();for(b in c)if(c.hasOwnProperty(b)&&b.toLowerCase()===a)return c[b];return null},open:function(a,b,c,d,e){if("undefined"==typeof a||"undefined"==typeof b)throw new Error("Not enough arguments");this.method=a,this.url=b,this.async="undefined"==typeof c?!0:!!c,this.username=d,this.password=e,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1,this.__DexterStateChange(this.OPENED)},send:function(a){var c;b(this.readyState,this.sendFlag),/^(get|head)$/i.test(this.method)||(this.requestHeaders["Content-Type"]?(c=this.requestHeaders["Content-Type"].split(";"),this.requestHeaders["Content-Type"]=c[0]+";charset=utf-8"):this.requestHeaders["Content-Type"]="text/plain;charset=utf-8",this.requestBody=a),this.errorFlag=!1,this.sendFlag=!0,this.__DexterStateChange(this.OPENED),"function"==typeof this.onSend&&this.onSend(this)},setRequestHeader:function(a,c){if(b(this.readyState,this.sendFlag),f.indexOf(a)>=0||/^(Sec-|Proxy-)/.test(a))throw new Error('Refused to set unsafe header "'+a+'"');this.requestHeaders[a]?this.requestHeaders[a]+=","+c:this.requestHeaders[a]=c},getAllResponseHeaders:function(){var a,b="";if(this.readyState<this.HEADERS_RECEIVED)return"";for(a in this.responseHeaders)this.responseHeaders.hasOwnProperty(a)&&!/^Set-Cookie2?$/i.test(a)&&(b+=a+": "+this.responseHeaders[a]+"\r\n");return b},__DexterSetResponseHeaders:function(a){var b;this.responseHeaders={};for(b in a)a.hasOwnProperty(b)&&(this.responseHeaders[b]=a[b]);this.async&&this.__DexterStateChange(this.HEADERS_RECEIVED)},__DexterXHR:!0,__DexterStateChange:function(a){var b;if(this.readyState=a,"function"==typeof this.onreadystatechange){try{b=document.createEvent("Event"),b.initEvent("readystatechange",!1,!1)}catch(c){b={type:"readystatechange"}}this.onreadystatechange.call(this,[b])}},__DexterSetResponseBody:function(a){var b,d=this.chunkSize||10,e=0;if(this.responseText="",this.async)for(;e<=a.length;)this.__DexterStateChange(this.LOADING),this.responseText+=a.substring(e,e+=d);else this.responseText=a;if(b=this.getResponseHeader("Content-Type")||"",a&&/(text\/xml)|(application\/xml)|(\+xml)/.test(b))try{this.responseXML=c(a)}catch(f){}},__DexterRespond:function(a){var b=a.body||"",c=a.headers||{},d=this.DONE;if(this.readyState===d)throw new Error("Request already done");this.__DexterSetResponseHeaders(c),this.status=a.status||200,this.statusText=e[this.status],this.__DexterSetResponseBody(b),this.async?this.__DexterStateChange(d):this.readyState=d}},h=function(){var b,c,d=this;this.requests=[],this.doneRequests=[],b=function(){return d.requests.push(this),this.__DexterRef=Date.now(),this},c=function(){b.call(this)},c.prototype=g,a.XMLHttpRequest=c},void(h.prototype={respond:function(a,b){var c;a=a||{},c=b?this.requests.splice(b,1)[0]:this.requests.shift(),c.__DexterRespond(a),this.doneRequests.push(c)},spy:function(a){var b=d.spy(g,"send",a);return this.__spy=b,b},restore:function(){this.__spy&&this.__spy.restore(),a.XMLHttpRequest=i.xhr}}))}(function(){return this}());
//# sourceMappingURL=dexter.min.js.map